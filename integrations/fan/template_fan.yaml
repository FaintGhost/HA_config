fan:
  - platform: template
    fans:
      my_fan:
        value_template: "{{ states('input_boolean.status_fan_power') }}"
        oscillating_template: "{{ states('input_select.status_fan_osc') }}"
        speed_template: "{{ states('input_text.status_fan_speed') }}"
        speeds: ["1", "2", "3"]
        turn_on:
          - condition: state
            entity_id: input_boolean.status_fan_power
            state: "off"
          - service: remote.send_command
            data:
              entity_id: remote.harmony
              device: 69866819
              command: PowerToggle
          - service: input_boolean.turn_on
            entity_id: input_boolean.status_fan_power
        turn_off:
          - service: remote.send_command
            data:
              entity_id: remote.harmony
              device: 69866819
              command: PowerToggle
          - service: input_boolean.turn_off
            entity_id: input_boolean.status_fan_power
        set_oscillating:
          - service_template: >
              {% if is_state('input_select.status_fan_osc', 'True') %}
                input_select.select_next
              {% elif is_state('input_select.status_fan_osc', 'False') %}
                input_select.select_next
              {% endif %}
            entity_id: input_select.status_fan_osc
          - service: remote.send_command
            data:
              entity_id: remote.harmony
              device: 69866819
              command: swing
        set_speed:
          - service: python_script.fan_speed_control
            data_template:
              fan_speed: "{{ speed }}"
          - service: input_text.set_value
            data_template:
              entity_id: input_text.status_fan_speed
              value: "{{ speed }}"

input_boolean:
  status_fan_power:
input_text:
  status_fan_speed:
input_select:
  status_fan_osc:
    options:
      - 'True'
      - 'False'

switch:
  - platform: template
    switches:
      fan_oscillate:
        friendly_name: 摇头
        value_template: "{{ is_state('input_select.status_fan_osc', 'True') }}"            
        turn_on:
          service: fan.oscillate
          data:
            entity_id: fan.my_fan
            oscillating: true
        turn_off:
          service: fan.oscillate
          data:
            entity_id: fan.my_fan
            oscillating: False
      fan_speed_one:
        friendly_name: 1档
        value_template: "{{ is_state('input_text.status_fan_speed', '1') }}"            
        turn_on:
          service: fan.set_speed
          data:
            entity_id: fan.my_fan
            speed: 1
        turn_off:
          service: fan.set_speed
          data:
            entity_id: fan.my_fan
            speed: 1
      fan_speed_two:
        friendly_name: 2档
        value_template: "{{ is_state('input_text.status_fan_speed', '2') }}"            
        turn_on:
          service: fan.set_speed
          data:
            entity_id: fan.my_fan
            speed: 2
        turn_off:
          service: fan.set_speed
          data:
            entity_id: fan.my_fan
            speed: 2
      fan_speed_three:
        friendly_name: 3档
        value_template: "{{ is_state('input_text.status_fan_speed', '3') }}"            
        turn_on:
          service: fan.set_speed
          data:
            entity_id: fan.my_fan
            speed: 3
        turn_off:
          service: fan.set_speed
          data:
            entity_id: fan.my_fan
            speed: 3