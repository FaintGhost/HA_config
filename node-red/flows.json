[{"id":"c392341e.28d2a8","type":"tab","label":"卧室","disabled":false,"info":""},{"id":"e6a2b36d.dc80e","type":"tab","label":"厨房","disabled":false,"info":""},{"id":"a2c1c82e.7e1968","type":"server","name":"Home Assistant","version":2,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30},{"id":"df417179.eb308","type":"mqtt-broker","name":"ha-mqtt","broker":"core-mosquitto","port":"1883","clientid":"","autoConnect":true,"usetls":false,"compatmode":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"bd1df63777ec9892","type":"zigbee2mqtt-server","name":"zigbee2mqtt","host":"localhost","mqtt_port":"1883","mqtt_username":"FaintGhost","mqtt_password":"941231zyW@","mqtt_qos":"2","tls":"","usetls":false,"base_topic":"zigbee2mqtt"},{"id":"7595a0e9.48dcc","type":"switch","z":"c392341e.28d2a8","name":"状态","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":180,"wires":[["7b45aff5.77487"],[]]},{"id":"7b45aff5.77487","type":"api-call-service","z":"c392341e.28d2a8","name":"走廊灯明亮","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"xiaomi_miio","service":"light_set_scene","areaId":[],"deviceId":[],"entityId":["light.doorway_light"],"data":"{\"scene\":\"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":160,"wires":[[]]},{"id":"1c96a4f8.82e32b","type":"switch","z":"c392341e.28d2a8","name":"状态","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":240,"wires":[["ad101b9c.941808"],["1c505226.8f47be"]]},{"id":"7bad4756.13f738","type":"switch","z":"c392341e.28d2a8","name":"状态","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":420,"wires":[["ad101b9c.941808"],["24516ab6.e42dd6","768fdd66.49b754"]]},{"id":"1c505226.8f47be","type":"api-current-state","z":"c392341e.28d2a8","name":"门已关？","server":"a2c1c82e.7e1968","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.0x00158d0001b862e7_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":540,"y":300,"wires":[[],["ad3c6262.6eb77"]]},{"id":"275f243f.61e12c","type":"api-current-state","z":"c392341e.28d2a8","name":"是否还有人?","server":"a2c1c82e.7e1968","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.0x00158d000257f9fb_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":550,"y":380,"wires":[["1c96a4f8.82e32b"],["24516ab6.e42dd6"]]},{"id":"ad101b9c.941808","type":"time-range-switch","z":"c392341e.28d2a8","name":"白天or夜晚","lat":"51.3375","lon":"12.377","startTime":"08:00","endTime":"00:00","startOffset":0,"endOffset":0,"x":550,"y":240,"wires":[["7b45aff5.77487","91ad489f.acbc88"],["d96899fc.3e9a98","3cc112dd.08c09e"]]},{"id":"91ad489f.acbc88","type":"api-call-service","z":"c392341e.28d2a8","name":"厕所灯明亮","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.0x7cb03eaa0a00c711"],"data":"{\"brightness_pct\":\"100\",\"kelvin\":\"6500\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":280,"wires":[[]]},{"id":"d96899fc.3e9a98","type":"api-call-service","z":"c392341e.28d2a8","name":"走廊灯夜间","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"xiaomi_miio","service":"light_set_scene","areaId":[],"deviceId":[],"entityId":["light.doorway_light"],"data":"{\"scene\":\"4\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":220,"wires":[[]]},{"id":"3cc112dd.08c09e","type":"api-call-service","z":"c392341e.28d2a8","name":"厕所灯夜间","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.0x7cb03eaa0a00c711"],"data":"{\"brightness_pct\":\"10\",\"kelvin\":\"2000\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":340,"wires":[[]]},{"id":"ad3c6262.6eb77","type":"delay","z":"c392341e.28d2a8","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":740,"y":320,"wires":[["275f243f.61e12c"]]},{"id":"24516ab6.e42dd6","type":"api-call-service","z":"c392341e.28d2a8","name":"关闭走廊灯","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.doorway_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":400,"wires":[[]]},{"id":"768fdd66.49b754","type":"api-call-service","z":"c392341e.28d2a8","name":"关闭厕所灯","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.0x7cb03eaa0a00c711"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":460,"wires":[[]]},{"id":"10c71ec5.648a61","type":"switch","z":"c392341e.28d2a8","name":"状态","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"flip90","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":100,"wires":[["8de4f8b9.b55948"]]},{"id":"8de4f8b9.b55948","type":"api-call-service","z":"c392341e.28d2a8","name":"厨房开关","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"switch","service":"toggle","areaId":[],"deviceId":[],"entityId":["switch.kitchen_socket"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":100,"wires":[[]]},{"id":"b46337b9.579d88","type":"switch","z":"c392341e.28d2a8","name":"状态","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"single","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":40,"wires":[["89a3d1aa.a5c84"]]},{"id":"89a3d1aa.a5c84","type":"api-call-service","z":"c392341e.28d2a8","name":"顶灯开关","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.ceiling_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":40,"wires":[[]]},{"id":"e146cf4a.2e05","type":"switch","z":"c392341e.28d2a8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"single","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":600,"wires":[["32711d9.dae64e2"]]},{"id":"32711d9.dae64e2","type":"api-call-service","z":"c392341e.28d2a8","name":"厕所灯明亮","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.0x7cb03eaa0a00c711"],"data":"{\"brightness_pct\":\"100\",\"kelvin\":\"6500\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":430,"y":600,"wires":[[]]},{"id":"d0620ab5.a10fb8","type":"server-state-changed","z":"c392341e.28d2a8","name":"卫生间动作","server":"a2c1c82e.7e1968","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.toilet_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":540,"wires":[["13d40ed0.3a8351"]]},{"id":"13d40ed0.3a8351","type":"switch","z":"c392341e.28d2a8","name":"状态","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":270,"y":540,"wires":[["448ae8a0.eb2be8"],[]]},{"id":"448ae8a0.eb2be8","type":"time-range-switch","z":"c392341e.28d2a8","name":"白天or夜晚","lat":"51.3375","lon":"12.377","startTime":"08:00","endTime":"00:00","startOffset":0,"endOffset":0,"x":430,"y":540,"wires":[[],[]]},{"id":"3097be77de416807","type":"zigbee2mqtt-in","z":"c392341e.28d2a8","name":"无线开关","server":"bd1df63777ec9892","friendly_name":"0x00158d0001563f1a","device_id":"0x00158d0001563f1a","state":"action","outputAtStartup":true,"filterChanges":false,"x":100,"y":40,"wires":[["b46337b9.579d88"]]},{"id":"7b5aa1e225ca505f","type":"mqtt in","z":"c392341e.28d2a8","name":"新设备添加","topic":"zigbee2mqtt/bridge/event","qos":"2","datatype":"auto","broker":"df417179.eb308","nl":false,"rap":true,"rh":0,"inputs":0,"x":100,"y":680,"wires":[["544f4a9ca3d37be8"]]},{"id":"544f4a9ca3d37be8","type":"json","z":"c392341e.28d2a8","name":"","property":"payload","action":"","pretty":false,"x":250,"y":680,"wires":[["04f51709627320a6"]]},{"id":"a2edecf28b5a10a3","type":"template","z":"c392341e.28d2a8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"title\":\"新设备已添加\",\"message\":\"名称: {{payload.data.friendly_name}}\\n型号: {{payload.data.definition.model}}\\n厂商: {{payload.data.definition.vendor}}\\n描述: {{payload.data.definition.description}}\\n支持: {{payload.data.supported}}\"}","output":"json","x":530,"y":680,"wires":[["ef4f51809b9febd3"]]},{"id":"04f51709627320a6","type":"switch","z":"c392341e.28d2a8","name":"","property":"payload.data.status","propertyType":"msg","rules":[{"t":"eq","v":"successful","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":390,"y":680,"wires":[["a2edecf28b5a10a3"]]},{"id":"ef4f51809b9febd3","type":"api-call-service","z":"c392341e.28d2a8","name":"通知","server":"a2c1c82e.7e1968","version":5,"debugenabled":true,"domain":"notify","service":"persistent_notification","areaId":[],"deviceId":[],"entityId":[],"data":"msg.payload","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":680,"wires":[[]]},{"id":"605a1c2f588a1557","type":"zigbee2mqtt-bridge","z":"c392341e.28d2a8","name":"zigbee2mqtt","server":"bd1df63777ec9892","topic":null,"x":110,"y":760,"wires":[[]]},{"id":"ec6af741.29f718","type":"mqtt in","z":"c392341e.28d2a8","name":"","topic":"zigbee2mqtt/0x00158d0002564da3/action","qos":"2","datatype":"auto","broker":"df417179.eb308","inputs":0,"x":200,"y":100,"wires":[["10c71ec5.648a61"]]},{"id":"40b3e561192777d3","type":"zigbee2mqtt-in","z":"c392341e.28d2a8","name":"","server":"bd1df63777ec9892","friendly_name":"墙面无线开关","device_id":"0x00158d0002a8bd26","state":"action","outputAtStartup":true,"filterChanges":false,"x":110,"y":600,"wires":[["e146cf4a.2e05"]]},{"id":"06952f4ca7bb24ad","type":"server-state-changed","z":"c392341e.28d2a8","name":"卧室门","server":"a2c1c82e.7e1968","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.0x00158d0001b862e7_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":90,"y":420,"wires":[["7bad4756.13f738"]]},{"id":"878a577b552e5ff6","type":"server-state-changed","z":"c392341e.28d2a8","name":"走廊人体","server":"a2c1c82e.7e1968","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.0x00158d000257f9fb_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":240,"wires":[["1c96a4f8.82e32b"]]},{"id":"fa384cb8d0ea5899","type":"server-state-changed","z":"c392341e.28d2a8","name":"大门","server":"a2c1c82e.7e1968","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.0x00158d0001bf47c1_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":90,"y":180,"wires":[["7595a0e9.48dcc"]]},{"id":"2ddfdc8705eef20a","type":"exec","z":"c392341e.28d2a8","command":"ifconfig","addpay":"","append":"| grep inet6 | grep -v fe80 | grep -v /128 | awk '/inet6/{print $3}' | sed 's#/64##' | tr -d '\\n'","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":240,"y":840,"wires":[["46971bd37f997073","3e263992790a4364"],[],[]]},{"id":"46971bd37f997073","type":"debug","z":"c392341e.28d2a8","name":"","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":260,"y":900,"wires":[]},{"id":"3e263992790a4364","type":"template","z":"c392341e.28d2a8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"https://api.cloudflare.com/client/v4/zones/f3cd9596d3a29f8d2a0a9971051e6ffe/dns_records/d604638ac901912fd9ef974629a3919c\" -H \"Authorization: Bearer sh0Q7ZRzigb1DTWNB7l_izEV0JBQ0CVxogvBXrd4\" -H \"Content-Type: application/json\" --data '{\"type\":\"AAAA\",\"name\":\"ha.v6.awyun.top\",\"content\":\"{{payload}}\",\"ttl\":1,\"proxied\":false}'","output":"str","x":390,"y":840,"wires":[["22932644622b5b09"]]},{"id":"22932644622b5b09","type":"exec","z":"c392341e.28d2a8","command":"curl","addpay":"payload","append":"-X PUT","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":530,"y":840,"wires":[["eefd9dafff08ed4a"],[],[]]},{"id":"fdb1afbeac3ab79f","type":"debug","z":"c392341e.28d2a8","name":"","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload.success","targetType":"msg","statusVal":"payload","statusType":"auto","x":870,"y":840,"wires":[]},{"id":"eefd9dafff08ed4a","type":"json","z":"c392341e.28d2a8","name":"","property":"payload","action":"","pretty":false,"x":670,"y":840,"wires":[["fdb1afbeac3ab79f"]]},{"id":"9c4944d2c1825f0a","type":"inject","z":"c392341e.28d2a8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 00 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":960,"wires":[["3254ca3472b7e1ba"]]},{"id":"3254ca3472b7e1ba","type":"api-call-service","z":"c392341e.28d2a8","name":"Auto Backup","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"auto_backup","service":"backup_full","areaId":[],"deviceId":[],"entityId":[],"data":"{\"keep_days\":3}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":270,"y":960,"wires":[[]]},{"id":"4b90f062bf42d2f2","type":"ha-entity","z":"c392341e.28d2a8","name":"consumed_energy","server":"a2c1c82e.7e1968","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"consumed_energy"},{"property":"device_class","value":"energy"},{"property":"icon","value":""},{"property":"unit_of_measurement","value":"kWh"},{"property":"state_class","value":"total_increasing"},{"property":"last_reset","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"payload","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1190,"y":1640,"wires":[[]]},{"id":"531e79a3ae7afee9","type":"debug","z":"c392341e.28d2a8","name":"","active":true,"tosidebar":true,"console":true,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":880,"y":1340,"wires":[]},{"id":"f3ec27a0686a5518","type":"api-current-state","z":"c392341e.28d2a8","name":"电磁炉插座","server":"a2c1c82e.7e1968","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.0x00158d00012db5eb_energy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"induktion_energy","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":250,"y":1540,"wires":[["dd211ea63a728942"]]},{"id":"863662928127bbb1","type":"inject","z":"c392341e.28d2a8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":1540,"wires":[["f3ec27a0686a5518"]]},{"id":"dd211ea63a728942","type":"api-current-state","z":"c392341e.28d2a8","name":"厨房插座","server":"a2c1c82e.7e1968","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.0x00158d000154b2cb_energy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"kitchen_energy","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":420,"y":1540,"wires":[["da13f19fd3000bf5"]]},{"id":"da13f19fd3000bf5","type":"api-current-state","z":"c392341e.28d2a8","name":"桌下插座","server":"a2c1c82e.7e1968","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.0x00158d0001e89755_energy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"desk_energy","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":580,"y":1540,"wires":[["5219bddbbdb253a5"]]},{"id":"5219bddbbdb253a5","type":"api-current-state","z":"c392341e.28d2a8","name":"床头插座","server":"a2c1c82e.7e1968","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.0x00158d0001e8975b_energy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"bedside_energy","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":740,"y":1540,"wires":[["9e65ea7d35191bdd"]]},{"id":"9e65ea7d35191bdd","type":"api-current-state","z":"c392341e.28d2a8","name":"地下插座","server":"a2c1c82e.7e1968","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.0x00158d000236c60a_energy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"floor_energy","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":900,"y":1540,"wires":[["18d4911f5fd73a49"]]},{"id":"18d4911f5fd73a49","type":"function","z":"c392341e.28d2a8","name":"","func":"var a = Number(msg.kitchen_energy)\nvar b = Number(msg.bedside_energy)\nvar c = Number(msg.floor_energy)\nvar d = Number(msg.induktion_energy)\nvar e = Number(msg.desk_energy)\nmsg.payload = parseFloat(a + b + c + d + e).toFixed(2)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1050,"y":1540,"wires":[["531e79a3ae7afee9"]]},{"id":"1848d41d.1f0fac","type":"switch","z":"e6a2b36d.dc80e","name":"状态","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":80,"wires":[["c4c204f9.15e708"],["aeb8e2e4.b6"]]},{"id":"c4c204f9.15e708","type":"api-call-service","z":"e6a2b36d.dc80e","name":"打开厨房灯","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"xiaomi_miio","service":"light_set_scene","areaId":[],"deviceId":[],"entityId":["light.kitchen_light"],"data":"{\"scene\":\"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":950,"y":80,"wires":[[]]},{"id":"aeb8e2e4.b6","type":"api-call-service","z":"e6a2b36d.dc80e","name":"关闭厨房灯","server":"a2c1c82e.7e1968","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":950,"y":140,"wires":[[]]},{"id":"f08d0535.ff1f68","type":"switch","z":"e6a2b36d.dc80e","name":"状态","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":140,"wires":[["c4c204f9.15e708"],["baf09fc9.cfbdd"]]},{"id":"baf09fc9.cfbdd","type":"api-current-state","z":"e6a2b36d.dc80e","name":"门已关？","server":"a2c1c82e.7e1968","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.0x00158d0001583bba_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":520,"y":160,"wires":[[],["4361bf72.c6b55"]]},{"id":"40945616.933f98","type":"api-current-state","z":"e6a2b36d.dc80e","name":"是否还有人?","server":"a2c1c82e.7e1968","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.0x00158d00010f84dd_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":530,"y":240,"wires":[["f08d0535.ff1f68"],["aeb8e2e4.b6"]]},{"id":"4361bf72.c6b55","type":"delay","z":"e6a2b36d.dc80e","name":"","pauseType":"delay","timeout":"300","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":700,"y":160,"wires":[["40945616.933f98"]]},{"id":"b206383896c1f04d","type":"server-state-changed","z":"e6a2b36d.dc80e","name":"厨房门","server":"a2c1c82e.7e1968","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.0x00158d0001583bba_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":80,"wires":[["1848d41d.1f0fac"]]},{"id":"2de512b5092f6d47","type":"server-state-changed","z":"e6a2b36d.dc80e","name":"厨房人体","server":"a2c1c82e.7e1968","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.0x00158d00010f84dd_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":120,"y":140,"wires":[["f08d0535.ff1f68"]]}]